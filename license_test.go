package widevine

import (
	"testing"
)

func TestGetContentKey(t *testing.T) {
	options := Options{
		Key:      key,
		IV:       iv,
		Provider: "widevine_test",
	}
	wv := New(options)

	contentID := "testing"

	// Make the request to generate or get a content key.
	policy := Policy{
		ContentID: contentID,
		Tracks:    []string{"SD", "HD", "AUDIO"},
		DRMTypes:  []string{"WIDEVINE"},
		Policy:    "default",
	}
	resp := wv.GetContentKey(contentID, policy)

	if resp.Status != "OK" {
		t.Error()
	}
}

func TestGetLicense(t *testing.T) {
	options := Options{
		Key:      key,
		IV:       iv,
		Provider: "widevine_test",
	}
	wv := New(options)

	// contentID := "testing"
	licenseOptions := LicenseOptions{
		Body: testLicenseChallenge, // Base64 string of license generated by CDM.
	}
	resp := wv.GetLicense(licenseOptions)

	if resp.Status != "OK" {
		t.Error()
	}
}

// Test Challenge simulating a request from a Widevine CDM payload.
// https://demo.unified-streaming.com/video/tears-of-steel/tears-of-steel-dash-widevine.ism/.mpd
const testLicenseChallenge = `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`
